# LINE Messaging API 買い物リスト・タスクリストBot

Google Apps Script (GAS) を使用したLINE Messaging APIの買い物リスト・タスクリスト管理Botです。

## 機能

### 買い物リスト機能
- **アイテム追加**: 「買い物追加　牛乳」でリストにアイテムを追加
- **アイテム削除**: 「買い物削除　卵」でリストからアイテムを削除
- **一覧表示**: 「買い物一覧」で現在のリストを表示

### タスクリスト機能
- **タスク追加**: 「タスク追加　掃除」でリストにタスクを追加
- **タスク削除**: 「タスク削除　洗濯」でリストからタスクを削除
- **一覧表示**: 「タスク一覧」で現在のリストを表示

### スプレッドシート連携
- **シート1**: 買い物リスト管理
- **シート2**: タスクリスト管理（自動作成）

## セットアップ手順

### 1. LINE Developers Console での設定

1. [LINE Developers Console](https://developers.line.biz/console/) にアクセス
2. 新しいプロバイダーを作成（または既存のプロバイダーを選択）
3. **Messaging API** チャンネルを作成
4. **チャンネルアクセストークン（長期）** を取得
5. **Webhook URL** を設定（後述のGAS WebアプリURL）

### 2. Google Apps Script での設定

1. [Google Apps Script](https://script.google.com/) にアクセス
2. 新しいプロジェクトを作成
3. `shopping_list_bot.gs` のコードをコピー&ペースト
4. **CHANNEL_ACCESS_TOKEN** を実際のトークンに置き換え
5. **デプロイ** → **新しいデプロイ** → **ウェブアプリ** を選択
   - 説明: 「LINE Bot Webhook」
   - 次のユーザーとして実行: 「自分」
   - アクセスできるユーザー: **「全員」**
6. **デプロイ** をクリックしてWebアプリURLを取得

### 3. LINE側のWebhook設定

1. LINE Developers Console で **Webhook URL** にGASのWebアプリURLを設定
2. **Webhookの利用** を有効化
3. **検証** ボタンで動作確認（タイムアウトエラーが出ても問題ありません）

### 4. Google Spreadsheet の準備

1. 新しいGoogle Spreadsheetを作成
2. シート名を「シート1」にする（デフォルト）
3. シート2は自動的に作成されます（タスクリスト用）
4. GASプロジェクトと同じGoogleアカウントでアクセス可能にする

## 使用方法

LINEアプリでBotに以下のメッセージを送信：

### 買い物リスト操作
- `買い物追加　牛乳` - 買い物リストに「牛乳」を追加
- `買い物削除　卵` - 買い物リストから「卵」を削除
- `買い物一覧` - 現在の買い物リストを表示

### タスクリスト操作
- `タスク追加　掃除` - タスクリストに「掃除」を追加
- `タスク削除　洗濯` - タスクリストから「洗濯」を削除
- `タスク一覧` - 現在のタスクリストを表示

## ファイル構成

```
├── shopping_list_bot.gs    # メインのGASコード
├── README.md              # このファイル
└── .gitignore             # Git除外設定
```

## テスト機能

GASエディタで以下の関数を実行してテストできます：

### 買い物リストテスト
- `checkSpreadsheet()` - スプレッドシートの状態確認
- `testAddShoppingItem()` - 買い物アイテム追加テスト
- `testDeleteShoppingItem()` - 買い物アイテム削除テスト
- `testGetShoppingList()` - 買い物一覧取得テスト

### タスクリストテスト
- `testAddTask()` - タスク追加テスト
- `testDeleteTask()` - タスク削除テスト
- `testGetTaskList()` - タスク一覧取得テスト

## トラブルシューティング

### Webhook検証でタイムアウトエラーが出る場合
- GASのWebアプリが「全員」に公開されているか確認
- 実際のLINEアプリからメッセージを送信して動作確認

### 認証エラー（HTTP 403）が出る場合
- チャンネルアクセストークンが正しいか確認
- トークンの有効期限を確認

### スプレッドシートにアクセスできない場合
- GASプロジェクトとスプレッドシートが同じGoogleアカウントか確認
- スプレッドシートの共有設定を確認

## セキュリティ注意事項

⚠️ **重要**: チャンネルアクセストークンは機密情報です。GitHubにアップロードする際は必ず環境変数や設定ファイルで管理してください。

## ライセンス

MIT License

## 作者

[shigeta9-9]

## 更新履歴

- v2.0.0 - タスクリスト機能追加
  - タスクリスト管理機能を追加
  - 買い物リストコマンドを「買い物追加」「買い物削除」「買い物一覧」に変更
  - タスクリストコマンド「タスク追加」「タスク削除」「タスク一覧」を追加
  - シート2（タスクリスト）の自動作成機能
- v1.0.0 - 初期リリース
  - 基本的な買い物リスト管理機能
  - LINE Messaging API連携
  - Google Spreadsheet連携
