# LINE Messaging API 買い物リスト・タスクリストBot

Google Apps Script (GAS) を使用したLINE Messaging APIの買い物リスト・タスクリスト管理Botです。

## 機能

### 買い物リスト機能
- **アイテム追加**: 「買い物追加　牛乳」でリストにアイテムを追加
- **複数アイテム追加**: 「買い物追加　パン、バナナ、トマト」で複数アイテムを一括追加（読点区切り）
- **複数アイテム追加**: 「買い物追加　パン　バナナ　トマト」で複数アイテムを一括追加（スペース区切り）
- **アイテム削除**: 「買い物削除　卵」でリストからアイテムを削除
- **複数アイテム削除**: 「買い物削除　パン、バナナ、トマト」で複数アイテムを一括削除（読点区切り）
- **複数アイテム削除**: 「買い物削除　パン　バナナ　トマト」で複数アイテムを一括削除（スペース区切り）
- **一覧表示**: 「買い物一覧」で現在のリストを表示

### タスクリスト機能
- **タスク追加**: 「タスク追加　掃除」でリストにタスクを追加
- **複数タスク追加**: 「タスク追加　掃除、洗濯、料理」で複数タスクを一括追加（読点区切り）
- **複数タスク追加**: 「タスク追加　掃除　洗濯　料理」で複数タスクを一括追加（スペース区切り）
- **タスク削除**: 「タスク削除　洗濯」でリストからタスクを削除
- **複数タスク削除**: 「タスク削除　掃除、洗濯、料理」で複数タスクを一括削除（読点区切り）
- **複数タスク削除**: 「タスク削除　掃除　洗濯　料理」で複数タスクを一括削除（スペース区切り）
- **一覧表示**: 「タスク一覧」で現在のリストを表示

### リマインド機能
- **買い物リマインド**: 「買い物通知　12」で12時に買い物リストを自動送信
- **タスクリマインド**: 「タスク通知　9」で9時にタスクリストを自動送信
- **リマインド削除**: 「リマインド削除　12」で12時のリマインドを削除
- **リマインド一覧**: 「リマインド一覧」で設定済みリマインドを表示
- **時間指定**: 24時間表記（0〜9時は先頭に0をつけない）
- **スペース対応**: 全角スペース（　）と半角スペース（ ）の両方に対応

### スプレッドシート連携
- **シート1**: 買い物リスト管理
- **シート2**: タスクリスト管理（自動作成）
- **シート3**: リマインド設定管理（自動作成）

### 入力対応機能
- **全角・半角スペース対応**: 全角スペース（　）と半角スペース（ ）の両方に対応
- **複数アイテム一括追加**: 読点（、）やスペースで区切って複数のアイテム・タスクを一度に追加
- **混在区切り文字対応**: 読点とスペースを組み合わせた入力にも対応

## セットアップ手順

### 1. LINE Developers Console での設定

1. [LINE Developers Console](https://developers.line.biz/console/) にアクセス
2. 新しいプロバイダーを作成（または既存のプロバイダーを選択）
3. **Messaging API** チャンネルを作成
4. **チャンネルアクセストークン（長期）** を取得
5. **Webhook URL** を設定（後述のGAS WebアプリURL）

### 2. Google Apps Script での設定

1. [Google Apps Script](https://script.google.com/) にアクセス
2. 新しいプロジェクトを作成
3. `shopping_list_bot.gs` のコードをコピー&ペースト
4. **CHANNEL_ACCESS_TOKEN** を実際のトークンに置き換え
5. **デプロイ** → **新しいデプロイ** → **ウェブアプリ** を選択
   - 説明: 「LINE Bot Webhook」
   - 次のユーザーとして実行: 「自分」
   - アクセスできるユーザー: **「全員」**
6. **デプロイ** をクリックしてWebアプリURLを取得

### 3. LINE側のWebhook設定

1. LINE Developers Console で **Webhook URL** にGASのWebアプリURLを設定
2. **Webhookの利用** を有効化
3. **検証** ボタンで動作確認（タイムアウトエラーが出ても問題ありません）

### 4. Google Spreadsheet の準備

1. 新しいGoogle Spreadsheetを作成
2. シート名を「シート1」にする（デフォルト）
3. シート2は自動的に作成されます（タスクリスト用）
4. GASプロジェクトと同じGoogleアカウントでアクセス可能にする

## 使用方法

LINEアプリでBotに以下のメッセージを送信：

### 買い物リスト操作
- `買い物追加　牛乳` - 買い物リストに「牛乳」を追加
- `買い物追加　パン、バナナ、トマト` - 買い物リストに複数アイテムを一括追加（読点区切り）
- `買い物追加　パン　バナナ　トマト` - 買い物リストに複数アイテムを一括追加（スペース区切り）
- `買い物削除　卵` - 買い物リストから「卵」を削除
- `買い物削除　パン、バナナ、トマト` - 買い物リストから複数アイテムを一括削除（読点区切り）
- `買い物削除　パン　バナナ　トマト` - 買い物リストから複数アイテムを一括削除（スペース区切り）
- `買い物一覧` - 現在の買い物リストを表示

### タスクリスト操作
- `タスク追加　掃除` - タスクリストに「掃除」を追加
- `タスク追加　掃除、洗濯、料理` - タスクリストに複数タスクを一括追加（読点区切り）
- `タスク追加　掃除　洗濯　料理` - タスクリストに複数タスクを一括追加（スペース区切り）
- `タスク削除　洗濯` - タスクリストから「洗濯」を削除
- `タスク削除　掃除、洗濯、料理` - タスクリストから複数タスクを一括削除（読点区切り）
- `タスク削除　掃除　洗濯　料理` - タスクリストから複数タスクを一括削除（スペース区切り）
- `タスク一覧` - 現在のタスクリストを表示

### リマインド操作
- `買い物通知　12` - 12時に買い物リストをリマインド
- `タスク通知　9` - 9時にタスクリストをリマインド
- `リマインド削除　12` - 12時のリマインドを削除
- `リマインド一覧` - 設定済みリマインド一覧を表示

## ファイル構成

```
├── shopping_list_bot.gs    # メインのGASコード
├── README.md              # このファイル
└── .gitignore             # Git除外設定
```

## テスト機能

GASエディタで以下の関数を実行してテストできます：

### 買い物リストテスト
- `checkSpreadsheet()` - スプレッドシートの状態確認
- `testAddShoppingItem()` - 買い物アイテム追加テスト
- `testAddMultipleShoppingItems()` - 複数買い物アイテム追加テスト（読点区切り）
- `testAddMultipleShoppingItemsWithSpace()` - 複数買い物アイテム追加テスト（スペース区切り）
- `testDeleteShoppingItem()` - 買い物アイテム削除テスト
- `testDeleteMultipleShoppingItems()` - 複数買い物アイテム削除テスト（読点区切り）
- `testDeleteMultipleShoppingItemsWithSpace()` - 複数買い物アイテム削除テスト（スペース区切り）
- `testGetShoppingList()` - 買い物一覧取得テスト

### タスクリストテスト
- `testAddTask()` - タスク追加テスト
- `testAddMultipleTasks()` - 複数タスク追加テスト（読点区切り）
- `testAddMultipleTasksWithSpace()` - 複数タスク追加テスト（スペース区切り）
- `testDeleteTask()` - タスク削除テスト
- `testDeleteMultipleTasks()` - 複数タスク削除テスト（読点区切り）
- `testDeleteMultipleTasksWithSpace()` - 複数タスク削除テスト（スペース区切り）
- `testGetTaskList()` - タスク一覧取得テスト

### リマインド機能テスト
- `testSetShoppingReminder()` - 買い物リマインド設定テスト
- `testSetTaskReminder()` - タスクリマインド設定テスト
- `testDeleteReminder()` - リマインド削除テスト
- `testGetReminderList()` - リマインド一覧取得テスト
- `testSendReminder()` - リマインド送信テスト（手動実行用）
- `testReminderFunctions()` - リマインド機能総合テスト

## トラブルシューティング

### Webhook検証でタイムアウトエラーが出る場合
- GASのWebアプリが「全員」に公開されているか確認
- 実際のLINEアプリからメッセージを送信して動作確認

### 認証エラー（HTTP 403）が出る場合
- チャンネルアクセストークンが正しいか確認
- トークンの有効期限を確認

### スプレッドシートにアクセスできない場合
- GASプロジェクトとスプレッドシートが同じGoogleアカウントか確認
- スプレッドシートの共有設定を確認

## セキュリティ注意事項

⚠️ **重要**: チャンネルアクセストークンは機密情報です。GitHubにアップロードする際は必ず環境変数や設定ファイルで管理してください。

## ライセンス

MIT License

## 作者

[shigeta9-9]

## 更新履歴

- v4.0.0 - リマインド機能追加
  - 買い物リスト・タスクリストのリマインド機能を追加
  - 指定時間に自動でリストを送信する機能
  - リマインド設定・削除・一覧表示機能
  - シート3（リマインド設定）の自動作成機能
  - Google Apps Scriptのトリガー機能を使用した自動実行
  - リマインド機能のテスト関数を追加
  - 全角・半角スペース対応（リマインドコマンド）
  - 24時間表記対応（0〜9時は先頭に0をつけない）
- v3.0.0 - 複数アイテム・タスク一括追加・削除機能と全角・半角スペース対応
  - 複数アイテム・タスクの一括追加機能を追加（読点区切り、スペース区切り対応）
  - 複数アイテム・タスクの一括削除機能を追加（読点区切り、スペース区切り対応）
  - 全角スペース（U+3000）と半角スペース（U+0020）の両方に対応
  - 混在した区切り文字（読点とスペースの組み合わせ）にも対応
  - 複数アイテム追加・削除時の結果表示を改善（箇条書き表示、成功・失敗の個別表示）
  - 新しいテスト関数を追加
- v2.0.0 - タスクリスト機能追加
  - タスクリスト管理機能を追加
  - 買い物リストコマンドを「買い物追加」「買い物削除」「買い物一覧」に変更
  - タスクリストコマンド「タスク追加」「タスク削除」「タスク一覧」を追加
  - シート2（タスクリスト）の自動作成機能
- v1.0.0 - 初期リリース
  - 基本的な買い物リスト管理機能
  - LINE Messaging API連携
  - Google Spreadsheet連携
